image: registry.videolan.org/videolan-gitlab-pages:20200201115354

variables:
  HTML_BASEURL: https://docs.videolan.me/vlc-user
  VERSION: $CI_COMMIT_REF_NAME

# Create a global cache to keep other branch and jobs pages
cache:
  key: one-cache-to-rule-them-all
  paths:
  - public

pages:
  tags:
  - pages
  stage: deploy
  script:
  - make versioned_localized_html LANGUAGE=en
  - make versioned_redirect LANGUAGE=en
  - mkdir -p public
  - rm -rf public/$VERSION
  - mv _build/html/$VERSION public/$VERSION
  artifacts:
    paths:
    - public

# Create a global redirection from root url to the "latest" english site
redirect:
  tags:
  - pages
  stage: deploy
  script:
  - make global_redirect LANGUAGE=en
  - mkdir -p public
  - rm -rf public/index.html
  - mv _build/html/index.html public/index.html
  artifacts:
    paths:
    - public
  only:
    variables:
      - $CI_COMMIT_REF_NAME == "3.0"

